{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/bises/OneDrive/Desktop/digital-twin-team2/digital-twin-frontend/src/lib/persistent-auth-db.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DB_FILE = path.join(process.cwd(), 'users-db.json');\r\n\r\ninterface User {\r\n  id: string;\r\n  email: string;\r\n  password: string;\r\n  name: string;\r\n}\r\n\r\ninterface UsersDB {\r\n  users: User[];\r\n}\r\n\r\n// Initialize database with default users\r\nfunction initializeDB(): UsersDB {\r\n  try {\r\n    if (fs.existsSync(DB_FILE)) {\r\n      const data = fs.readFileSync(DB_FILE, 'utf-8');\r\n      return JSON.parse(data);\r\n    }\r\n  } catch (error) {\r\n    console.error('Error reading database:', error);\r\n  }\r\n\r\n  // Default database with test users\r\n  const defaultDB: UsersDB = {\r\n    users: [\r\n      {\r\n        id: 'user_test',\r\n        email: 'test@example.com',\r\n        password: 'password123',\r\n        name: 'Test User',\r\n      },\r\n      {\r\n        id: 'user_demo',\r\n        email: 'demo@example.com',\r\n        password: 'demo12345',\r\n        name: 'Demo User',\r\n      },\r\n    ],\r\n  };\r\n\r\n  try {\r\n    fs.writeFileSync(DB_FILE, JSON.stringify(defaultDB, null, 2));\r\n  } catch (error) {\r\n    console.error('Error writing default database:', error);\r\n  }\r\n\r\n  return defaultDB;\r\n}\r\n\r\n// Read current database\r\nfunction readDB(): UsersDB {\r\n  try {\r\n    if (fs.existsSync(DB_FILE)) {\r\n      const data = fs.readFileSync(DB_FILE, 'utf-8');\r\n      return JSON.parse(data);\r\n    }\r\n  } catch (error) {\r\n    console.error('Error reading database:', error);\r\n  }\r\n  return initializeDB();\r\n}\r\n\r\n// Write to database\r\nfunction writeDB(db: UsersDB): void {\r\n  try {\r\n    fs.writeFileSync(DB_FILE, JSON.stringify(db, null, 2));\r\n  } catch (error) {\r\n    console.error('Error writing database:', error);\r\n  }\r\n}\r\n\r\nexport const persistentAuthDB = {\r\n  getUserByEmail: (email: string): User | undefined => {\r\n    const db = readDB();\r\n    return db.users.find((u) => u.email === email);\r\n  },\r\n\r\n  createUser: (email: string, password: string, name: string): User => {\r\n    const db = readDB();\r\n    const newUser: User = {\r\n      id: `user_${Date.now()}`,\r\n      email,\r\n      password,\r\n      name,\r\n    };\r\n    db.users.push(newUser);\r\n    writeDB(db);\r\n    console.log('User created and persisted:', email);\r\n    return newUser;\r\n  },\r\n\r\n  userExists: (email: string): boolean => {\r\n    const db = readDB();\r\n    return db.users.some((u) => u.email === email);\r\n  },\r\n\r\n  getAllUsers: (): User[] => {\r\n    const db = readDB();\r\n    return db.users;\r\n  },\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAazC,yCAAyC;AACzC,SAAS;IACP,IAAI;QACF,IAAI,wGAAE,CAAC,UAAU,CAAC,UAAU;YAC1B,MAAM,OAAO,wGAAE,CAAC,YAAY,CAAC,SAAS;YACtC,OAAO,KAAK,KAAK,CAAC;QACpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;IAC3C;IAEA,mCAAmC;IACnC,MAAM,YAAqB;QACzB,OAAO;YACL;gBACE,IAAI;gBACJ,OAAO;gBACP,UAAU;gBACV,MAAM;YACR;YACA;gBACE,IAAI;gBACJ,OAAO;gBACP,UAAU;gBACV,MAAM;YACR;SACD;IACH;IAEA,IAAI;QACF,wGAAE,CAAC,aAAa,CAAC,SAAS,KAAK,SAAS,CAAC,WAAW,MAAM;IAC5D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;IACnD;IAEA,OAAO;AACT;AAEA,wBAAwB;AACxB,SAAS;IACP,IAAI;QACF,IAAI,wGAAE,CAAC,UAAU,CAAC,UAAU;YAC1B,MAAM,OAAO,wGAAE,CAAC,YAAY,CAAC,SAAS;YACtC,OAAO,KAAK,KAAK,CAAC;QACpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;IAC3C;IACA,OAAO;AACT;AAEA,oBAAoB;AACpB,SAAS,QAAQ,EAAW;IAC1B,IAAI;QACF,wGAAE,CAAC,aAAa,CAAC,SAAS,KAAK,SAAS,CAAC,IAAI,MAAM;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;IAC3C;AACF;AAEO,MAAM,mBAAmB;IAC9B,gBAAgB,CAAC;QACf,MAAM,KAAK;QACX,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,KAAK,KAAK;IAC1C;IAEA,YAAY,CAAC,OAAe,UAAkB;QAC5C,MAAM,KAAK;QACX,MAAM,UAAgB;YACpB,IAAI,CAAC,KAAK,EAAE,KAAK,GAAG,IAAI;YACxB;YACA;YACA;QACF;QACA,GAAG,KAAK,CAAC,IAAI,CAAC;QACd,QAAQ;QACR,QAAQ,GAAG,CAAC,+BAA+B;QAC3C,OAAO;IACT;IAEA,YAAY,CAAC;QACX,MAAM,KAAK;QACX,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,KAAK,KAAK;IAC1C;IAEA,aAAa;QACX,MAAM,KAAK;QACX,OAAO,GAAG,KAAK;IACjB;AACF"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/bises/OneDrive/Desktop/digital-twin-team2/digital-twin-frontend/src/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { persistentAuthDB } from '@/lib/persistent-auth-db';\r\n\r\n// Simple JWT-like token generator (In production, use proper JWT)\r\nfunction generateToken(userId: string, email: string): string {\r\n  const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));\r\n  const payload = btoa(\r\n    JSON.stringify({\r\n      userId,\r\n      email,\r\n      iat: Math.floor(Date.now() / 1000),\r\n      exp: Math.floor(Date.now() / 1000) + 24 * 60 * 60, // 24 hours\r\n    })\r\n  );\r\n  const signature = btoa(`${header}.${payload}`);\r\n  return `${header}.${payload}.${signature}`;\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { email, password } = body;\r\n\r\n    // Validation\r\n    if (!email || !password) {\r\n      return NextResponse.json(\r\n        { message: 'Email and password are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Find user\r\n    const user = persistentAuthDB.getUserByEmail(email);\r\n\r\n    if (!user || user.password !== password) {\r\n      return NextResponse.json(\r\n        { message: 'Invalid email or password' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Generate token\r\n    const token = generateToken(user.id, user.email);\r\n\r\n    // Create response with token in cookie\r\n    const response = NextResponse.json(\r\n      {\r\n        message: 'Login successful',\r\n        token,\r\n        user: {\r\n          id: user.id,\r\n          email: user.email,\r\n          name: user.name,\r\n        },\r\n      },\r\n      { status: 200 }\r\n    );\r\n\r\n    // Set auth token in cookie\r\n    response.cookies.set('auth_token', token, {\r\n      httpOnly: false,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 24 * 60 * 60, // 24 hours\r\n    });\r\n\r\n    return response;\r\n  } catch (error) {\r\n    console.error('Login error:', error);\r\n    return NextResponse.json(\r\n      { message: 'Internal server error' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,kEAAkE;AAClE,SAAS,cAAc,MAAc,EAAE,KAAa;IAClD,MAAM,SAAS,KAAK,KAAK,SAAS,CAAC;QAAE,KAAK;QAAS,KAAK;IAAM;IAC9D,MAAM,UAAU,KACd,KAAK,SAAS,CAAC;QACb;QACA;QACA,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;QAC7B,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,QAAQ,KAAK,KAAK;IACjD;IAEF,MAAM,YAAY,KAAK,GAAG,OAAO,CAAC,EAAE,SAAS;IAC7C,OAAO,GAAG,OAAO,CAAC,EAAE,QAAQ,CAAC,EAAE,WAAW;AAC5C;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAE5B,aAAa;QACb,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,+KAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAkC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,YAAY;QACZ,MAAM,OAAO,2LAAgB,CAAC,cAAc,CAAC;QAE7C,IAAI,CAAC,QAAQ,KAAK,QAAQ,KAAK,UAAU;YACvC,OAAO,+KAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAA4B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,iBAAiB;QACjB,MAAM,QAAQ,cAAc,KAAK,EAAE,EAAE,KAAK,KAAK;QAE/C,uCAAuC;QACvC,MAAM,WAAW,+KAAY,CAAC,IAAI,CAChC;YACE,SAAS;YACT;YACA,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;YACjB;QACF,GACA;YAAE,QAAQ;QAAI;QAGhB,2BAA2B;QAC3B,SAAS,OAAO,CAAC,GAAG,CAAC,cAAc,OAAO;YACxC,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK;QACpB;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,+KAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAAwB,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}